.. currentmodule:: redzed

=======================
Logging, debug messages
=======================

.. Note::

  `Python logging [↗] <https://docs.python.org/3/library/logging.html>`_
  is a complex topic. You may need a more
  sophisticated setup than the basic example shown here.


Logger
======

Redzed's logging messages are delivered to a logger named after the package,
i.e. ``'redzed'``. These messages have level (a.k.a. severity) :const:`!logging.INFO`
and higher and if a non-zero :ref:`debug level <Debug levels>`
is set, also the severity :const:`!logging.DEBUG`.


Handlers
========

Logging messages are processed by logging handlers. The application
should create and configure them. If an application doesn't do that, Python will
only print messages with severity :const:`!logging.WARNING` or higher
to the standard output. Messages with severities :const:`!logging.DEBUG`
and :const:`!logging.INFO` won't be printed.

The easiest way to create a handler that will print all messages
to the standard error stream (i.e. to the terminal if not redirected)
is just one line::

  logging.basicConfig(level=logging.DEBUG)

Being just a library, Redzed should not interfere with the logging
configuration. However, debugging needs debug messages, so we made
an exception from the rule:

.. important::

  Under circumstances explained below, Redzed will create and use a
  `StreamHandler [↗] <https://docs.python.org/3/library/logging.handlers.html#logging.StreamHandler>`_
  that will print messages of severity DEBUG and higher.

If the :ref:`debug level <Debug levels>` is not zero and there are no
logging handlers configured, Redzed's attaches a :class:`!StreamHandler`
to its logger and stops propagating log records to the root logger.
This is done initially when the circuit runner is started
and then each time a non-zero debug level is set.

In other words, to have the logging completely under control,
please configure it before you call :func:`redzed.run`.


Debug output
============

Because the debugging can be enabled only for the whole circuit, the amount of
debug output may be substantial. When analyzing it, lines of no interest can
be easily filtered out, because every line is prefixed. Debug messages from blocks,
formulas and triggers are prefixed by the object name in angle brackets,
e.g. ``<Memory name='input1'>``. Messages generated by the circuit runner
are prefixed by ``[Circuit]`` in square brackets.


Debug levels
============

.. function:: set_debug_level(level: int) -> None

  Set the new debug level 0 to 3. The debug level is a global setting.

  - Level 0:
      Debug message are disabled. This is the initial value
      unless overridden by :envvar:`REDZED_DEBUG` in the environment.

  - Level 1:
      Selected debug messages are enabled.

  - Level 2:
      All debug messages are enabled. The output can be verbose.

  - Level 3:
      Like level 2, but all messages are logged with relative timestamps
      taken from :meth:`redzed.Circuit.runtime`.

.. function:: get_debug_level() -> int

  Get the current debug level 0 to 3.


Setting the debug level from environment
----------------------------------------

Following environment variable can be set to enable debug messages.
It is processed at the program start. Subsequent environment
changes have no effect.

.. envvar:: REDZED_DEBUG

  The initial debug level. If the variable is set, its value should be 0, 1, 2 or 3.
  An empty value is ignored. All other values are rejected with an
  informative message.
